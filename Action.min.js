(function(){var n,r,e,t,o,u;r=function(r,e){return e instanceof n?e._go(r):r(e)},n=function(){function n(n){this._go=n}return n.prototype._next=function(e){var t;return t=this,new n(function(n){return t._go(function(t){return r(n,e(t))})})},n.prototype.next=function(e){var t;return t=this,new n(function(n){return t._go(function(t){return t instanceof Error?n(t):r(n,e(t))})})},n.prototype.guard=function(e){var t;return t=this,new n(function(n){return t._go(function(t){return t instanceof Error?r(n,e(t)):n(t)})})},n.prototype.go=function(n){return this._go(function(r){if(r instanceof Error)throw r;return null!=n?n(r):r})},n}(),n.wrap=function(r){return new n(function(n){return n(r)})},n.signal=new n(function(n){return n}),n.fuseSignal=function(r,e){var t;return null==e&&(e=!1),t=r.length,t>0?new n(function(n){var o,u,i,a,c,f,l,s,d,w;for(d=new Array(t),w=new Array(t),i=new Array(t),a=c=0,s=t-1;s>=0?s>=c:c>=s;a=s>=0?++c:--c)i[a]=!1;for(u=function(r){return function(o){var u,c,f;for(d[r]=o,i[r]=!0,c=!0,a=u=0,f=t-1;f>=0?f>=u:u>=f;a=f>=0?++u:--u)if(i[a]===!1&&(c=!1),d[a]instanceof Error&&e){c=!1,n(d[a]);break}return c?n(d):void 0}},a=l=0,f=r.length;f>l;a=++l)o=r[a],w[a]=o._go(u(a));return w}):n.wrap([])},n.freeze=function(r){var e,t,o,u;return o=!0,t=void 0,e=[],u=r._go(function(n){var r,u,i;if(o){for(t=n,o=!1,u=0,i=e.length;i>u;u++)(r=e[u])(n);return e=void 0}}),new n(function(n){return o?e.push(n):n(t),u})},n.safe=function(n,r){return function(e){var t,o;try{return r(e)}catch(o){return t=o,n}}},n.safeRaw=function(n){return function(r){var e,t;try{return n(r)}catch(t){return e=t}}},n.chain=function(r){return function(e){var t,o,u,i,a;if(r.length>0){for(t=r[0](e),a=r.slice(1),o=0,u=a.length;u>o;o++)i=a[o],t=t.next(i);return t}return n.wrap(void 0)}},n.repeat=function(n,r,e){var t;return null==e&&(e=!1),t=r._next(function(r){return r instanceof Error&&e||0===n--?r:t})},n.delay=function(r,e){return new n(function(n){return setTimeout(n,r)})._next(function(){return e})},n.retry=function(n,r){var e;return e=r.guard(function(r){return 0!==n--?e:new Error("RETRY_ERROR: Retry limit reached")})},n.parallel=function(r,e){var t;return null==e&&(e=!1),t=r.length,t>0?new n(function(n){var o,u,i,a,c,f,l,s;for(u=t,l=new Array(t),s=new Array(t),i=function(r){return function(t){return t instanceof Error&&e?("function"==typeof n&&n(t),n=void 0,u=-1):(l[r]=t,0===--u?n(l):void 0)}},a=c=0,f=r.length;f>c;a=++c)o=r[a],s[a]=o._go(i(a));return s}):n.wrap([])},n.join=function(e,t,o){var u;return u=new Array(2),new n(function(n){var i,a,c;return a=c=void 0,i=2,u[0]=e._go(function(e){return a=e,i--,0===i?r(n,o(a,c)):void 0}),u[1]=t._go(function(e){return c=e,i--,0===i?r(n,o(a,c)):void 0}),u})},n.race=function(r,e){var t;return null==e&&(e=!1),t=r.length,t>0?new n(function(n){var o,u,i,a,c,f;for(u=t,f=new Array(t),i=a=0,c=r.length;c>a;i=++a)o=r[i],f[i]=o._go(function(r){return u--,r instanceof Error&&!e?0===u?n(new Error("RACE_ERROR: All actions failed")):void 0:("function"==typeof n&&n(r),n=void 0,u=-1)});return f}):n.wrap(new Error("RACE_ERROR: All actions failed"))},o=function(n,r,e,t,u,i){return t[n]._go(function(a){return a instanceof Error&&e?i(a):(u[n++]=a,n===r?i(u):o(n,r,e,t,u,i))})},n.sequence=function(r,e){var t;return null==e&&(e=!1),t=r.length,t>0?new n(function(n){var u;return u=new Array(t),o(0,t,e,r,u,n)}):n.wrap([])},e=function(n){return function(r,e){return n(r?r:e)}},n.makeNodeAction=function(r){return function(t,o,u){var i,a,c,f,l;switch(l=this,f=arguments.length){case 0:i=function(n){return r.call(l,e(n))};break;case 1:i=function(n){return r.call(l,t,e(n))};break;case 2:i=function(n){return r.call(l,t,o,e(n))};break;case 3:i=function(n){return r.call(l,t,o,u,e(n))};break;default:for(c=f,a=new Array(f+1);c-->0;)a[c]=arguments[c];i=function(n){return a[f]=e(n),r.apply(l,a)}}return new n(i)}},u=function(n,r,e){return r._go(function(r){var t,o,i;return r instanceof Error&&n["throw"](r),i=n.next(r),o=i.value,t=i.done,t?e(r):u(n,o,e)})},n.co=function(r){return function(){var e;return e=r.apply(this,arguments),new n(function(n){return u(e,e.next().value,n)})}},t=function(n,r){var e,o,u,i;u=[];for(e in r)i=r[e],o=n?n+"["+e+"]":e,"object"==typeof i?u.push(t(o,i)):null!=i&&u.push(encodeURIComponent(o)+"="+encodeURIComponent(i));return u.join("&")},n.param=function(n){return t("",n)},n.jsonp=function(r){return new n(function(n){var e,t;return e="callback_"+Math.round(1e16*Math.random()).toString(36),t=document.createElement("script"),window[e]=function(r){return t.parentNode.removeChild(t),n(r),window[e]=void 0},t.onerror=function(){return t.parentNode.removeChild(t),n(new Error("REQUEST_ERROR: error when making jsonp request")),window[e]=void 0,!1},t.onload=function(){return!1},t.src=r.url+(-1===r.url.indexOf("?")?"?":"&")+(r.callback?r.callback:"callback")+"="+e,t.callbackName=e,document.body.appendChild(t),t})},n.ajax=function(r){return new n(function(n){var e,t,o,u;u=new window.XMLHttpRequest,u.open(r.method,r.url,!0,r.user,r.password),u.onload=function(){return 4===u.readyState?n(u.status>=200&&u.status<300?null!=r.responseType?u.response:u.responseText:new Error("REQUEST_ERROR: status"+u.status)):void 0},t=r.headers;for(e in t)o=t[e],u.setRequestHeader(e,o);switch(r.timeout&&(u.timeout=r.timeout,u.ontimeout=function(){return n(new Error("REQUEST_ERROR: timeout"))}),r.responseType&&(u.responseType=r.responseType),typeof r.data){case"string":u.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),u.send(r.data);break;case"object":r.data instanceof window.FormData?u.send(r.data):(u.setRequestHeader("Content-Type","application/json; charset=UTF-8"),u.send(JSON.stringify(r.data)));break;default:u.send()}return u})},"undefined"!=typeof module&&null!==module&&null!=module.exports?module.exports=n:"function"==typeof define&&define.amd?define(function(){return n}):"undefined"!=typeof window&&null!==window&&(window.Action=n)}).call(this);
